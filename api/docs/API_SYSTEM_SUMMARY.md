# ğŸ”§ APIç®¡ç†ç³»ç»Ÿå®Œæ•´éƒ¨ç½²æ€»ç»“

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

æˆ‘ä»¬å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„APIç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

### âœ… å·²å®Œæˆçš„åŠŸèƒ½

1. **å…¬å…±APIé…ç½®ç®¡ç†** (`api_config.py`)
   - 4ç§ç”¨æˆ·è§’è‰²æƒé™æ§åˆ¶ï¼ˆGuestã€Userã€VIPã€Adminï¼‰
   - 4ç§APIç±»å‹åˆ†ç±»ï¼ˆPublicã€Privateã€Protectedã€Internalï¼‰
   - åŠ¨æ€APIç«¯ç‚¹ç®¡ç†
   - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
   - é€Ÿç‡é™åˆ¶é…ç½®

2. **ç§æœ‰APIå¯†é’¥ç®¡ç†** (`private_api_manager.py`)
   - æ”¯æŒå¤šä¸ªAPIæä¾›å•†ï¼ˆOpenAIã€Claudeã€Googleç­‰ï¼‰
   - FernetåŠ å¯†ç®—æ³•å®‰å…¨å­˜å‚¨
   - æ—¥/æœˆä½¿ç”¨é™åˆ¶æ§åˆ¶
   - è¯¦ç»†ä½¿ç”¨ç»Ÿè®¡å’Œç›‘æ§
   - å¯†é’¥çŠ¶æ€ç®¡ç†ï¼ˆæ´»è·ƒã€åœç”¨ã€è¿‡æœŸã€æš‚åœï¼‰

3. **Webç®¡ç†ç•Œé¢** (`api_web_manager.py`)
   - åŸºäºStreamlitçš„å¯è§†åŒ–ç®¡ç†ç•Œé¢
   - ç³»ç»Ÿæ¦‚è§ˆå’Œç»Ÿè®¡å›¾è¡¨
   - APIç«¯ç‚¹CRUDæ“ä½œ
   - ç§æœ‰å¯†é’¥ç®¡ç†
   - ä½¿ç”¨ç»Ÿè®¡åˆ†æ
   - æƒé™æµ‹è¯•å·¥å…·

4. **å®Œæ•´æ–‡æ¡£å’Œç¤ºä¾‹**
   - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
   - ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
   - å®‰å…¨é…ç½®è¯´æ˜

## ğŸŒ è®¿é—®åœ°å€

- **APIç®¡ç†ç•Œé¢**: http://localhost:56336
- **å…¬ç½‘è®¿é—®**: http://13.57.59.89:56336
- **RAGä¸»ç³»ç»Ÿ**: http://localhost:51657

## ğŸ“ æ–‡ä»¶ç»“æ„

```
rag_system/config/
â”œâ”€â”€ api_config.py                 # å…¬å…±APIé…ç½®ç®¡ç†æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ private_api_manager.py        # ç§æœ‰APIå¯†é’¥ç®¡ç†æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ api_web_manager.py           # Webç®¡ç†ç•Œé¢
â”œâ”€â”€ api_usage_example.py         # ä½¿ç”¨ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ API_MANAGEMENT_README.md     # è¯¦ç»†ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ API_SYSTEM_SUMMARY.md        # æœ¬æ€»ç»“æ–‡æ¡£
â”œâ”€â”€ api_endpoints.json           # APIç«¯ç‚¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ private_apis.json            # ç§æœ‰APIé…ç½®æ–‡ä»¶ï¼ˆåŠ å¯†ï¼‰
â”œâ”€â”€ api_encryption.key           # åŠ å¯†å¯†é’¥æ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰
â””â”€â”€ api_manager.log              # Webç•Œé¢æ—¥å¿—
```

## ğŸ” å®‰å…¨ç‰¹æ€§

### 1. åŠ å¯†å­˜å‚¨
- âœ… ä½¿ç”¨Fernetå¯¹ç§°åŠ å¯†ç®—æ³•
- âœ… ç‹¬ç«‹çš„åŠ å¯†å¯†é’¥æ–‡ä»¶
- âœ… æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸º600
- âœ… å¯†é’¥ä¸é…ç½®åˆ†ç¦»å­˜å‚¨

### 2. æƒé™æ§åˆ¶
- âœ… å¤šå±‚æ¬¡è§’è‰²æƒé™éªŒè¯
- âœ… APIç±»å‹åˆ†çº§ç®¡ç†
- âœ… ç»†ç²’åº¦è®¿é—®æ§åˆ¶
- âœ… æƒé™æµ‹è¯•å·¥å…·

### 3. ä½¿ç”¨ç›‘æ§
- âœ… å®æ—¶ä½¿ç”¨ç»Ÿè®¡
- âœ… æ—¥/æœˆé™åˆ¶æ§åˆ¶
- âœ… å¼‚å¸¸ä½¿ç”¨æ£€æµ‹
- âœ… è¯¦ç»†å®¡è®¡æ—¥å¿—

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

### 1. æƒé™éªŒè¯æµç¨‹
```python
# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®API
has_permission = check_api_access('advanced_chat', 'vip')  # True

# è·å–ç”¨æˆ·å¯è®¿é—®çš„APIåˆ—è¡¨
user_apis = get_user_apis('user')  # è¿”å›ç”¨æˆ·å¯è®¿é—®çš„APIåˆ—è¡¨
```

### 2. ç§æœ‰å¯†é’¥ç®¡ç†
```python
# æ·»åŠ ç”¨æˆ·çš„APIå¯†é’¥
key_id = add_user_api_key(
    user_id="user123",
    provider="openai",
    key_name="æˆ‘çš„OpenAIå¯†é’¥",
    api_key="sk-proj-...",
    daily_limit=100
)

# è·å–å¯ç”¨çš„APIå¯†é’¥
key_result = get_user_api_key("user123", "openai")
if key_result:
    key_id, api_key = key_result
```

### 3. å®Œæ•´APIè°ƒç”¨æµç¨‹
```python
def handle_api_request(user_id, user_role, api_endpoint, provider):
    # 1. æƒé™æ£€æŸ¥
    if not check_api_access(api_endpoint, user_role):
        return {"error": "æƒé™ä¸è¶³"}
    
    # 2. è·å–APIå¯†é’¥
    key_result = get_user_api_key(user_id, provider)
    if not key_result:
        return {"error": "æ— å¯ç”¨å¯†é’¥"}
    
    # 3. ä½¿ç”¨é™åˆ¶æ£€æŸ¥
    # 4. è°ƒç”¨API
    # 5. è®°å½•ä½¿ç”¨
    # 6. è¿”å›ç»“æœ
```

## ğŸ“Š ç³»ç»Ÿç»Ÿè®¡

### é»˜è®¤é…ç½®
- **APIç«¯ç‚¹**: 10ä¸ªï¼ˆ2ä¸ªå…¬å…±ï¼Œ2ä¸ªç§æœ‰ï¼Œ5ä¸ªå—ä¿æŠ¤ï¼Œ1ä¸ªå†…éƒ¨ï¼‰
- **ç”¨æˆ·è§’è‰²**: 4ç§ï¼ˆGuestã€Userã€VIPã€Adminï¼‰
- **APIæä¾›å•†**: 6ç§ï¼ˆOpenAIã€Claudeã€Googleã€ç™¾åº¦ã€é˜¿é‡Œäº‘ã€è‡ªå®šä¹‰ï¼‰
- **å¯†é’¥çŠ¶æ€**: 4ç§ï¼ˆæ´»è·ƒã€åœç”¨ã€è¿‡æœŸã€æš‚åœï¼‰

### æƒé™çŸ©é˜µ
| è§’è‰² | Public | Private | Protected | Internal |
|------|--------|---------|-----------|----------|
| Guest | âœ… | âŒ | âŒ | âŒ |
| User | âœ… | âœ… | âŒ | âŒ |
| VIP | âœ… | âœ… | âœ… (VIP) | âŒ |
| Admin | âœ… | âœ… | âœ… (All) | âŒ |

## ğŸ› ï¸ ç®¡ç†æ“ä½œ

### é€šè¿‡Webç•Œé¢
1. **è®¿é—®**: http://localhost:56336
2. **ç³»ç»Ÿæ¦‚è§ˆ**: æŸ¥çœ‹APIå’Œå¯†é’¥ç»Ÿè®¡
3. **ç«¯ç‚¹ç®¡ç†**: æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤APIç«¯ç‚¹
4. **å¯†é’¥ç®¡ç†**: ç®¡ç†ç”¨æˆ·çš„ç§æœ‰APIå¯†é’¥
5. **ä½¿ç”¨ç»Ÿè®¡**: æŸ¥çœ‹è¯¦ç»†çš„ä½¿ç”¨æŠ¥å‘Š
6. **æƒé™æµ‹è¯•**: æµ‹è¯•ä¸åŒè§’è‰²çš„APIè®¿é—®æƒé™

### é€šè¿‡ä»£ç 
```python
# è·å–ç®¡ç†å™¨å®ä¾‹
from api_config import get_api_config
from private_api_manager import get_private_api_manager

api_manager = get_api_config()
private_manager = get_private_api_manager()

# ç³»ç»Ÿæ¦‚è§ˆ
summary = api_manager.get_api_summary()
print(f"æ€»APIæ•°: {summary['total_endpoints']}")

# ç”¨æˆ·ç»Ÿè®¡
stats = private_manager.get_usage_statistics("user123")
```

## ğŸ”„ é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

### 1. åœ¨RAGç³»ç»Ÿä¸­é›†æˆ
```python
# åœ¨ rag_system/public/public_mobile_app.py ä¸­æ·»åŠ 
from config.api_config import check_api_access
from config.private_api_manager import get_user_api_key

def chat_with_permission_check(user_id, user_role, message):
    # æ£€æŸ¥èŠå¤©æƒé™
    if not check_api_access('user_chat', user_role):
        return "æ‚¨æ²¡æœ‰æƒé™ä½¿ç”¨èŠå¤©åŠŸèƒ½"
    
    # è·å–ç”¨æˆ·çš„APIå¯†é’¥
    key_result = get_user_api_key(user_id, 'openai')
    if not key_result:
        return "è¯·å…ˆé…ç½®æ‚¨çš„APIå¯†é’¥"
    
    key_id, api_key = key_result
    # ä½¿ç”¨api_keyè°ƒç”¨OpenAI API
    # ...
```

### 2. æ·»åŠ åˆ°ç®¡ç†å‘˜é¢æ¿
```python
# åœ¨ç®¡ç†å‘˜é¢æ¿ä¸­æ·»åŠ APIç®¡ç†æ ‡ç­¾é¡µ
if selected_tab == "APIç®¡ç†":
    st.subheader("ğŸ”§ APIç³»ç»Ÿç®¡ç†")
    
    # åµŒå…¥APIç®¡ç†ç•Œé¢
    st.markdown("[æ‰“å¼€APIç®¡ç†ç•Œé¢](http://localhost:56336)")
    
    # æˆ–è€…ç›´æ¥é›†æˆæ ¸å¿ƒåŠŸèƒ½
    from config.api_config import APIConfigManager
    api_manager = APIConfigManager()
    summary = api_manager.get_api_summary()
    st.json(summary)
```

## ğŸš¨ é‡è¦æ³¨æ„äº‹é¡¹

### 1. å®‰å…¨è­¦å‘Š
- âš ï¸ **åŠ å¯†å¯†é’¥æ–‡ä»¶** (`api_encryption.key`) éå¸¸é‡è¦ï¼Œä¸¢å¤±å°†æ— æ³•è§£å¯†å·²å­˜å‚¨çš„APIå¯†é’¥
- âš ï¸ ç¡®ä¿é…ç½®æ–‡ä»¶æƒé™è®¾ç½®ä¸º600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
- âš ï¸ å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’ŒåŠ å¯†å¯†é’¥
- âš ï¸ ç”Ÿäº§ç¯å¢ƒä¸­åº”ä½¿ç”¨æ›´å¼ºçš„å¯†é’¥ç®¡ç†æ–¹æ¡ˆ

### 2. æ€§èƒ½è€ƒè™‘
- ğŸ“ˆ å¤§é‡APIå¯†é’¥æ—¶è€ƒè™‘æ•°æ®åº“å­˜å‚¨
- ğŸ“ˆ é«˜å¹¶å‘åœºæ™¯ä¸‹è€ƒè™‘ç¼“å­˜æœºåˆ¶
- ğŸ“ˆ å®šæœŸæ¸…ç†è¿‡æœŸçš„ä½¿ç”¨ç»Ÿè®¡æ•°æ®

### 3. æ‰©å±•å»ºè®®
- ğŸ”§ æ·»åŠ APIå¯†é’¥è‡ªåŠ¨è½®æ¢åŠŸèƒ½
- ğŸ”§ é›†æˆæ›´å¤šAPIæä¾›å•†
- ğŸ”§ æ·»åŠ Webhooké€šçŸ¥åŠŸèƒ½
- ğŸ”§ å®ç°APIè°ƒç”¨é“¾è·¯è¿½è¸ª

## ğŸ“ ä½¿ç”¨æ”¯æŒ

### å¸¸è§é—®é¢˜
1. **Q**: å¦‚ä½•é‡ç½®åŠ å¯†å¯†é’¥ï¼Ÿ
   **A**: åˆ é™¤ `api_encryption.key` æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæ–°å¯†é’¥ï¼Œä½†å·²å­˜å‚¨çš„å¯†é’¥å°†æ— æ³•è§£å¯†ã€‚

2. **Q**: å¦‚ä½•å¤‡ä»½ç³»ç»Ÿé…ç½®ï¼Ÿ
   **A**: å¤‡ä»½æ•´ä¸ª `config` ç›®å½•ï¼Œç‰¹åˆ«æ˜¯ `api_encryption.key` æ–‡ä»¶ã€‚

3. **Q**: å¦‚ä½•æ·»åŠ æ–°çš„APIæä¾›å•†ï¼Ÿ
   **A**: åœ¨ `APIProvider` æšä¸¾ä¸­æ·»åŠ æ–°çš„æä¾›å•†ç±»å‹ã€‚

### æŠ€æœ¯æ”¯æŒ
- ğŸ“§ æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–é”™è¯¯ä¿¡æ¯
- ğŸ” ä½¿ç”¨æƒé™æµ‹è¯•å·¥å…·è¯Šæ–­é—®é¢˜
- ğŸ“Š é€šè¿‡Webç•Œé¢ç›‘æ§ç³»ç»ŸçŠ¶æ€

## ğŸ‰ éƒ¨ç½²å®Œæˆ

âœ… **APIç®¡ç†ç³»ç»Ÿå·²å®Œå…¨éƒ¨ç½²å¹¶è¿è¡Œ**

- **Webç®¡ç†ç•Œé¢**: http://localhost:56336 âœ… è¿è¡Œä¸­
- **RAGä¸»ç³»ç»Ÿ**: http://localhost:51657 âœ… è¿è¡Œä¸­
- **é…ç½®æ–‡ä»¶**: å·²ç”Ÿæˆå¹¶åŠ å¯†å­˜å‚¨ âœ…
- **æƒé™ç³»ç»Ÿ**: å·²é…ç½®å¹¶æµ‹è¯• âœ…
- **ä½¿ç”¨ç»Ÿè®¡**: å·²å¯ç”¨å¹¶è®°å½• âœ…

æ‚¨ç°åœ¨å¯ä»¥ï¼š
1. ğŸŒ è®¿é—®Webç•Œé¢ç®¡ç†APIé…ç½®
2. ğŸ” å®‰å…¨åœ°å­˜å‚¨å’Œç®¡ç†ç”¨æˆ·çš„ç§æœ‰APIå¯†é’¥
3. ğŸ‘¥ æ§åˆ¶ä¸åŒç”¨æˆ·è§’è‰²çš„APIè®¿é—®æƒé™
4. ğŸ“Š ç›‘æ§APIä½¿ç”¨æƒ…å†µå’Œç»Ÿè®¡
5. ğŸ”§ åŠ¨æ€æ·»åŠ å’Œé…ç½®æ–°çš„APIç«¯ç‚¹

ç³»ç»Ÿå·²å‡†å¤‡å¥½æŠ•å…¥ä½¿ç”¨ï¼ğŸš€

---

**ç‰ˆæœ¬**: 1.0.0  
**éƒ¨ç½²æ—¶é—´**: 2025-08-18  
**çŠ¶æ€**: âœ… å®Œå…¨è¿è¡Œ  
**ç»´æŠ¤**: å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
<!DOCTYPE html>
<html>
<head>
    <title>RAG API 测试</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>RAG API 连接测试</h1>
    <button onclick="testHealth()">测试健康检查</button>
    <button onclick="testChat()">测试聊天</button>
    <div id="result"></div>

    <script>
        const RAG_URL = 'https://hull-projected-cattle-proc.trycloudflare.com';
        
        async function testHealth() {
            const result = document.getElementById('result');
            result.innerHTML = '测试中...';
            
            try {
                const start = Date.now();
                const response = await fetch(`${RAG_URL}/api/health`);
                const data = await response.json();
                const time = Date.now() - start;
                
                result.innerHTML = `
                    <h3>健康检查成功 ✅</h3>
                    <p>响应时间: ${time}ms</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `
                    <h3>健康检查失败 ❌</h3>
                    <p>错误: ${error.message}</p>
                `;
            }
        }
        
        async function testChat() {
            const result = document.getElementById('result');
            result.innerHTML = '测试中...';
            
            try {
                const start = Date.now();
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 60000); // 60秒超时
                
                const response = await fetch(`${RAG_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: '你好，这是一个测试'
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                const data = await response.json();
                const time = Date.now() - start;
                
                result.innerHTML = `
                    <h3>聊天测试成功 ✅</h3>
                    <p>响应时间: ${time}ms</p>
                    <p>回复: ${data.response}</p>
                `;
            } catch (error) {
                result.innerHTML = `
                    <h3>聊天测试失败 ❌</h3>
                    <p>错误: ${error.message}</p>
                    <p>错误类型: ${error.name}</p>
                `;
            }
        }
    </script>
</body>
</html>
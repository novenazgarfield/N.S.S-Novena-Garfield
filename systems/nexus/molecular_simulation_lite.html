<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å­æ¨¡æ‹Ÿ - è½»é‡ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            color: white;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            max-width: 300px;
            z-index: 100;
        }

        #info-panel h2 {
            margin: 0 0 15px 0;
            color: #4CAF50;
            font-size: 1.5em;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 200;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #4CAF50;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
        }

        .control-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        #atom-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
            z-index: 100;
        }

        .performance-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            color: #FFC107;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åŠ è½½è½»é‡ç‰ˆåˆ†å­æ¨¡æ‹Ÿ...</p>
        </div>

        <div id="info-panel">
            <div class="performance-warning">
                âš¡ è½»é‡ç‰ˆï¼šä¼˜åŒ–GPUæ€§èƒ½ï¼Œé™ä½æ¸²æŸ“å¤æ‚åº¦
            </div>
            <h2>ğŸ§¬ åˆ†å­æ¨¡æ‹Ÿ (è½»é‡ç‰ˆ)</h2>
            <p><strong>ä¼˜åŒ–:</strong> ä½å¤šè¾¹å½¢æ¨¡å‹</p>
            <p><strong>æ€§èƒ½:</strong> é€‚åˆä½ç«¯GPU</p>
            <p><strong>æ“ä½œ:</strong></p>
            <ul style="font-size: 12px; margin: 10px 0; padding-left: 20px;">
                <li>é¼ æ ‡æ‹–æ‹½: æ—‹è½¬è§†è§’</li>
                <li>æ»šè½®: ç¼©æ”¾</li>
            </ul>
        </div>

        <div id="atom-info">
            <div style="font-size: 18px; font-weight: bold; color: #4CAF50; margin-bottom: 10px;">
                åŸå­æ•°é‡: <span id="atom-count">0</span>
            </div>
            <div style="font-size: 12px;">
                <div>æ°¢(H): <span id="h-count">0</span></div>
                <div>ç¢³(C): <span id="c-count">0</span></div>
                <div>æ°®(N): <span id="n-count">0</span></div>
                <div>æ°§(O): <span id="o-count">0</span></div>
            </div>
        </div>

        <div id="controls">
            <button class="control-button" onclick="resetCamera()">ğŸ¯ é‡ç½®</button>
            <button class="control-button" onclick="toggleWireframe()">ğŸ”² çº¿æ¡†</button>
        </div>
    </div>

    <!-- Three.js æ ¸å¿ƒåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls;
        let atomGroup;
        let atoms = [];
        let wireframeMode = false;

        // ç®€åŒ–çš„åŸå­é¢œè‰²
        const atomColors = {
            'H': 0xFFFFFF,
            'C': 0x909090,
            'N': 0x3050F8,
            'O': 0xFF0D0D,
            'default': 0xFF1493
        };

        // ç®€åŒ–çš„åŸå­åŠå¾„
        const atomRadii = {
            'H': 0.3,
            'C': 0.4,
            'N': 0.35,
            'O': 0.32,
            'default': 0.4
        };

        function initScene() {
            console.log('ğŸš€ åˆå§‹åŒ–è½»é‡ç‰ˆåˆ†å­æ¨¡æ‹Ÿ...');

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(10, 10, 10);

            // ä½¿ç”¨åŸºç¡€æ¸²æŸ“å™¨è®¾ç½®
            renderer = new THREE.WebGLRenderer({ antialias: false }); // å…³é—­æŠ—é”¯é½¿æå‡æ€§èƒ½
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // é™åˆ¶åƒç´ æ¯”
            
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = false; // å…³é—­é˜»å°¼æå‡æ€§èƒ½

            // ç®€åŒ–å…‰ç…§
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);

            atomGroup = new THREE.Group();
            scene.add(atomGroup);

            console.log('âœ… è½»é‡ç‰ˆåœºæ™¯åˆå§‹åŒ–å®Œæˆ');
        }

        function createMockMolecule() {
            console.log('ğŸ”¬ åˆ›å»ºç®€åŒ–å’–å•¡å› åˆ†å­...');
            
            atoms = [];
            
            // åªåˆ›å»ºä¸»è¦åŸå­ï¼Œå‡å°‘æ•°é‡
            const mockAtoms = [
                { element: 'C', x: 0, y: 0, z: 0 },
                { element: 'C', x: 1.4, y: 0, z: 0 },
                { element: 'C', x: 2.1, y: 1.2, z: 0 },
                { element: 'N', x: 1.4, y: 2.4, z: 0 },
                { element: 'C', x: 0, y: 2.4, z: 0 },
                { element: 'N', x: -0.7, y: 1.2, z: 0 },
                { element: 'O', x: 3.3, y: 1.2, z: 0 },
                { element: 'H', x: -0.5, y: -0.9, z: 0 },
                { element: 'H', x: 1.9, y: -0.9, z: 0 },
                { element: 'H', x: 1.9, y: 3.3, z: 0 }
            ];

            // åˆ›å»ºå…±äº«å‡ ä½•ä½“ä»¥æå‡æ€§èƒ½
            const geometries = {};
            Object.keys(atomRadii).forEach(element => {
                const radius = atomRadii[element] * 0.5;
                // ä½¿ç”¨æä½å¤šè¾¹å½¢æ•° (4x4 è€Œä¸æ˜¯ 16x16)
                geometries[element] = new THREE.SphereGeometry(radius, 4, 4);
            });

            mockAtoms.forEach((atom, index) => {
                const position = new THREE.Vector3(atom.x, atom.y, atom.z);
                createAtom(atom.element, position, index, geometries);
                
                atoms.push({
                    element: atom.element,
                    position: position,
                    index: index
                });
            });

            updateAtomInfo();
            fitCameraToMolecule();
            
            console.log('âœ… ç®€åŒ–åˆ†å­åˆ›å»ºå®Œæˆ');
        }

        function createAtom(element, position, index, geometries) {
            const color = atomColors[element] || atomColors.default;
            const geometry = geometries[element] || geometries.default;

            // ä½¿ç”¨åŸºç¡€æè´¨æå‡æ€§èƒ½
            const material = new THREE.MeshLambertMaterial({
                color: color,
                transparent: false // å…³é—­é€æ˜åº¦
            });

            const atomMesh = new THREE.Mesh(geometry, material);
            atomMesh.position.copy(position);
            
            atomMesh.userData = {
                element: element,
                index: index
            };

            atomGroup.add(atomMesh);
        }

        function updateAtomInfo() {
            const elementCount = {};
            atoms.forEach(atom => {
                elementCount[atom.element] = (elementCount[atom.element] || 0) + 1;
            });
            
            document.getElementById('atom-count').textContent = atoms.length;
            document.getElementById('h-count').textContent = elementCount['H'] || 0;
            document.getElementById('c-count').textContent = elementCount['C'] || 0;
            document.getElementById('n-count').textContent = elementCount['N'] || 0;
            document.getElementById('o-count').textContent = elementCount['O'] || 0;
        }

        function fitCameraToMolecule() {
            if (atoms.length === 0) return;

            const box = new THREE.Box3();
            atomGroup.children.forEach(atom => {
                box.expandByObject(atom);
            });

            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            const maxDim = Math.max(size.x, size.y, size.z);

            const distance = maxDim * 3;
            camera.position.set(distance, distance, distance);
            camera.lookAt(center);
            
            controls.target.copy(center);
            controls.update();
        }

        function hideLoading() {
            const loading = document.getElementById('loading');
            loading.style.display = 'none';
        }

        function resetCamera() {
            fitCameraToMolecule();
        }

        function toggleWireframe() {
            wireframeMode = !wireframeMode;
            atomGroup.children.forEach(atom => {
                atom.material.wireframe = wireframeMode;
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function init() {
            console.log('ğŸ§¬ è½»é‡ç‰ˆåˆ†å­æ¨¡æ‹Ÿç³»ç»Ÿå¯åŠ¨...');
            
            initScene();
            
            setTimeout(() => {
                createMockMolecule();
                hideLoading();
            }, 500);
            
            animate();
            
            window.addEventListener('resize', onWindowResize, false);
            
            console.log('âœ… è½»é‡ç‰ˆç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>